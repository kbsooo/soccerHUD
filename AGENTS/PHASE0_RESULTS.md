# Phase 0 검증 결과

**날짜**: 2025-10-16
**환경**: MacBook Pro M4, 16GB RAM, macOS

---

## 📋 목표

Phase 0의 목적은 YOLOv8이 M4 MacBook에서 실시간으로 축구공과 선수를 탐지할 수 있는지 검증하는 것.

### 성공 기준
- ✅ **FPS**: 20+ FPS
- ⚠️ **탐지 정확도**: 공 70%+, 선수 80%+

---

## 🔧 환경 구축

### 설치된 패키지
- **Python**: 3.12.11
- **PyTorch**: 2.9.0
- **Ultralytics**: 8.3.216
- **coremltools**: 8.3.0
- **OpenCV**: 4.12.0

### MPS (Metal) 지원
- ✅ **MPS 사용 가능**: YES
- M4 칩의 Metal Performance Shaders 완벽 지원

---

## 🚀 FPS 벤치마크 결과

### 테스트 조건
- **입력 크기**: 640x640
- **측정 방법**: 50회 반복 평균
- **디바이스**: CPU, MPS (Metal)

### 결과 테이블

| 모델 | 해상도 | 디바이스 | FPS | 시간(ms) | 평가 |
|------|--------|----------|-----|----------|------|
| yolov8n | 480px | CPU | 32.8 | 30.5 | ✅ 매우 우수 |
| yolov8n | 480px | MPS | **112.6** | 8.9 | ✅ 매우 우수 |
| yolov8n | 640px | CPU | 33.0 | 30.3 | ✅ 매우 우수 |
| yolov8n | 640px | MPS | **119.9** | 8.3 | ✅ 매우 우수 |
| yolov8s | 480px | CPU | 15.5 | 64.3 | ⚠️ 보통 |
| yolov8s | 480px | MPS | 52.9 | 18.9 | ✅ 매우 우수 |
| yolov8s | 640px | CPU | 15.7 | 63.9 | ⚠️ 보통 |
| yolov8s | 640px | MPS | **43.6** | 22.9 | ✅ 매우 우수 |

### 핵심 발견

1. **MPS는 CPU보다 3-4배 빠름**
   - yolov8s: 15.7 FPS (CPU) → **43.6 FPS (MPS)**
   - yolov8n: 33.0 FPS (CPU) → **119.9 FPS (MPS)**

2. **실시간 처리 가능**
   - yolov8s + MPS: **43.6 FPS** ✅ (목표 20+ 달성)
   - yolov8n + MPS: **119.9 FPS** ✅✅✅

3. **CPU만으로는 부족**
   - yolov8s + CPU: **15.7 FPS** ❌ (목표 미달)

---

## 🍎 CoreML 변환 결과

### 변환 성공 ✅
- **모델**: yolov8s.pt → yolov8s.mlpackage
- **크기**: 21.5 MB
- **변환 시간**: 12초

### 성능 비교

| 형식 | 디바이스 | FPS | 시간(ms) |
|------|----------|-----|----------|
| PyTorch | MPS | 50.6 | 19.7 |
| CoreML | Metal | **119.0** | 8.4 |

### 결과
- **CoreML이 PyTorch보다 134.9% 더 빠름!** 🚀
- M4 Metal을 더 효율적으로 활용
- 프로덕션 배포 시 CoreML 사용 강력 추천

---

## ⚽ 탐지 정확도 검증

### 테스트 이미지
- **샘플**: Ultralytics 제공 축구 이미지 (지단)
- **해상도**: 1280x720

### 탐지 결과

| 항목 | 결과 |
|------|------|
| **선수 탐지** | ✅ 2명 탐지 |
| **공 탐지** | ❌ 없음 (이미지에 공 없음) |
| **기타 객체** | 넥타이 1개 |

### 평가
- ⚠️ **공 탐지 검증 불완전**: 테스트 이미지에 공이 없음
- ✅ **선수 탐지 성공**: Person 클래스로 정확히 탐지
- 📋 **추가 필요**: 실제 축구 경기 영상으로 공 탐지 재검증

### COCO 클래스 확인
- ✅ **Class 0**: person
- ✅ **Class 32**: sports ball

---

## 🎯 Lazy Tracking 예상 성능

### 전략
- **5 프레임마다 YOLO 실행** (1:4 비율)
- 나머지 4 프레임은 **Optical Flow** 추적 (~200 FPS)

### 계산

#### yolov8s + CoreML
```
YOLO FPS: 119.0
Optical Flow FPS: ~200
예상 실효 FPS = 5 / ((1/119) + (4/200)) ≈ 176 FPS
```

#### yolov8n + CoreML
```
YOLO FPS: 119.9
Optical Flow FPS: ~200
예상 실효 FPS ≈ 176 FPS
```

### 결론
- ✅ **Lazy Tracking으로 25+ FPS 달성 가능!**
- 실제로는 **176 FPS** 예상 (충분함!)

---

## 📊 Go/No-Go 결정

### FPS 목표: ✅ **GO**
- **목표**: 20+ FPS
- **결과**: 43.6 FPS (yolov8s + MPS)
- **평가**: **목표 달성!**

### 정확도 목표: ⚠️ **부분적 GO**
- **목표**: 공 70%+, 선수 80%+
- **선수 탐지**: ✅ 성공 (100%, 샘플 2/2)
- **공 탐지**: ⚠️ 미검증 (테스트 이미지 부족)
- **평가**: **선수는 OK, 공은 추가 검증 필요**

### 종합 판정: ✅ **GO for Phase 1**
- FPS는 충분히 빠름 (43.6 FPS)
- CoreML은 더욱 빠름 (119 FPS)
- 선수 탐지는 작동
- 공 탐지는 Phase 1에서 실제 영상으로 재검증

---

## 💡 최종 추천 설정

### 프로덕션 설정
```yaml
모델: yolov8s.mlpackage (CoreML)
입력 크기: 640x640
디바이스: Metal (CoreML)
예상 FPS: 119
전략: Lazy Tracking (5:4 비율)
실효 FPS: ~176
```

### 개발/테스트 설정
```yaml
모델: yolov8s.pt (PyTorch)
입력 크기: 640x640
디바이스: MPS
예상 FPS: 43.6
전략: 프레임마다 YOLO
```

---

## 🚧 발견된 제약사항

### 1. CPU 성능 부족
- **문제**: yolov8s + CPU = 15.7 FPS (목표 미달)
- **영향**: 저사양 PC 지원 불가
- **해결책**: GPU 필수 요구 사항으로 명시

### 2. 공 탐지 미검증
- **문제**: 테스트 이미지에 축구공 없음
- **영향**: COCO 'sports ball' 클래스 정확도 미확인
- **해결책**: Phase 1에서 실제 축구 영상으로 재검증

### 3. COCO 데이터셋 한계
- **문제**: 'sports ball'은 범용 (축구공, 농구공 등)
- **영향**: 축구공 특화되지 않음
- **해결책**: Phase 5 파인튜닝 시 개선

---

## 📋 다음 단계 (Phase 1)

### 즉시 시작 가능 ✅
1. **FastAPI 서버 구축**
   - WebSocket 엔드포인트
   - YOLO 추론 파이프라인
   - CoreML 모델 통합

2. **로컬 비디오 테스트**
   - 실제 축구 영상 다운로드
   - 공 소유자 판단 로직 구현
   - 유니폼 색상 클러스터링

3. **공 탐지 정확도 재검증**
   - 다양한 축구 영상 테스트
   - False Positive/Negative 분석
   - 필요시 파인튜닝 계획

### 대기 (Phase 3 이후)
- 등번호 OCR
- DeepSORT 추적
- Electron 패키징

---

## 🎉 성공 요인

1. **M4 Metal 성능**: MPS가 CPU보다 3-4배 빠름
2. **CoreML 최적화**: PyTorch보다 134% 빠름
3. **YOLO 효율성**: 사전학습 모델도 충분히 빠름
4. **Lazy Tracking 전략**: 실효 FPS를 크게 향상

---

## 📝 메모

### CoreML 경고
- Torch 2.9.0이 coremltools와 공식 테스트되지 않았지만, 변환/추론 모두 성공
- 프로덕션에서 안정성 모니터링 필요

### 저작권 주의
- 샘플 영상을 Git에 커밋하지 말 것
- `.gitignore`에 이미 추가됨

### 향후 최적화 가능성
- 입력 크기 다운스케일 (480px)
- yolov8n 사용 (더 빠름, 정확도 약간 낮음)
- TensorRT (NVIDIA GPU 시)

---

**Phase 0 완료!** ✅

**다음 목표**: Phase 1 - FastAPI 서버 및 YOLO 파이프라인 구축
