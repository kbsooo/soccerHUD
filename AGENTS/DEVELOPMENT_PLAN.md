# 개발 플랜 & 로드맵

## 📅 전체 타임라인: 8-10주

---

## Phase 0: 환경 구축 및 검증 (3-5일)

### 목표
YOLOv8이 M4에서 실시간으로 축구공/선수를 탐지할 수 있는지 검증

### 작업 목록
- [ ] Python 개발 환경 구축
  - [ ] Python 3.10+ 설치
  - [ ] 가상환경 생성 (`venv` or `conda`)
  - [ ] 필수 패키지 설치 (`requirements.txt`)
- [ ] YOLOv8 설치 및 테스트
  - [ ] `ultralytics` 패키지 설치
  - [ ] 사전학습 모델 다운로드 (yolov8s.pt)
  - [ ] 샘플 이미지로 추론 테스트
- [ ] CoreML 변환 및 M4 최적화
  - [ ] `coremltools` 설치
  - [ ] YOLOv8 → CoreML 변환
  - [ ] Metal GPU 활용 확인
- [ ] 샘플 축구 영상 수집
  - [ ] YouTube에서 테스트 영상 다운로드
  - [ ] 다양한 각도/조명 조건 포함
- [ ] FPS 벤치마크
  - [ ] 720p 영상으로 추론 속도 측정
  - [ ] 목표: 20+ FPS
  - [ ] yolov8s vs yolov8m 비교
- [ ] 공/선수 탐지 정확도 확인
  - [ ] COCO 데이터셋 클래스 활용
  - [ ] `sports ball`, `person` 탐지 테스트
  - [ ] 목표: 공 70%+, 선수 80%+ 탐지율

### Go/No-Go 결정 기준
- ✅ **Go**: FPS 20+ AND 탐지율 70%+
- ❌ **No-Go**: FPS < 15 OR 탐지율 < 60%
  - → 모델 경량화 or 클라우드 옵션 재고려

### 예상 완료일
D+5

---

## Phase 1: 백엔드 파이프라인 구축 (1주)

### 목표
비디오 프레임을 받아서 YOLO 추론 후 결과를 반환하는 서버 구축

### 작업 목록
- [ ] FastAPI 서버 기본 구조
  - [ ] WebSocket 엔드포인트 생성
  - [ ] 프레임 수신/디코딩 로직
  - [ ] CORS 설정 (localhost 허용)
- [ ] YOLO 추론 파이프라인
  - [ ] 프레임 전처리 (리사이즈, 정규화)
  - [ ] 배치 처리 최적화
  - [ ] 결과 후처리 (NMS, 필터링)
- [ ] 공 소유자 판단 로직
  - [ ] 공-선수 거리 계산
  - [ ] 가장 가까운 선수 선택
  - [ ] 임계값 설정 (너무 멀면 "소유 없음")
- [ ] 유니폼 색상 클러스터링
  - [ ] K-means로 팀 색상 추출
  - [ ] 선수별 유니폼 색상 매칭
  - [ ] 홈/원정 구분 로직
- [ ] JSON 응답 포맷 설계
```json
{
  "timestamp": 1234567890,
  "ball": {"x": 320, "y": 240, "confidence": 0.95},
  "players": [
    {"id": 1, "x": 300, "y": 250, "team": "red", "confidence": 0.88},
    {"id": 2, "x": 500, "y": 300, "team": "blue", "confidence": 0.92}
  ],
  "ball_owner": {"player_id": 1, "distance": 15.3}
}
```
- [ ] 로컬 비디오 파일로 E2E 테스트
  - [ ] OpenCV로 비디오 읽기
  - [ ] 프레임마다 처리
  - [ ] 결과 오버레이 영상 생성 (검증용)

### 예상 완료일
D+12 (Week 2 완료)

---

## Phase 2: 크롬 익스텐션 MVP (1주)

### 목표
YouTube 비디오에서 프레임을 캡처하고, 서버 결과를 오버레이로 표시

### 작업 목록
- [ ] 익스텐션 기본 구조
  - [ ] `manifest.json` 작성 (Manifest V3)
  - [ ] Content Script 설정
  - [ ] 권한 설정 (`activeTab`, `storage`)
- [ ] YouTube 비디오 감지
  - [ ] `<video>` 태그 찾기
  - [ ] 재생 상태 이벤트 리스너
  - [ ] 비디오 메타데이터 추출
- [ ] 프레임 캡처 로직
  - [ ] Canvas API로 비디오 캡처
  - [ ] 30 FPS 타이머 (requestAnimationFrame)
  - [ ] JPEG 인코딩 및 압축
- [ ] WebSocket 클라이언트
  - [ ] localhost:8765 연결
  - [ ] 프레임 전송 (Base64 or Blob)
  - [ ] 결과 수신 및 파싱
  - [ ] 재연결 로직 (서버 끊김 대응)
- [ ] 오버레이 렌더링
  - [ ] SVG 레이어 생성 (비디오 위에)
  - [ ] 바운딩 박스 그리기
  - [ ] 팀 색상으로 박스 색상 표시
  - [ ] "빨간 팀 선수가 공 소유" 텍스트 표시
- [ ] 간단한 UI/UX
  - [ ] 활성화/비활성화 토글 버튼
  - [ ] 연결 상태 표시 (녹색/빨간색)
  - [ ] 에러 메시지 표시

### 마일스톤
**"YouTube 영상에서 공 소유 선수에게 색상 박스 표시 성공"**

### 예상 완료일
D+19 (Week 3 완료)

---

## Phase 3: 선수 식별 고도화 (2주)

### 목표
선수의 이름과 등번호를 표시할 수 있도록 식별 정확도 향상

### 작업 목록

#### 실험 A: 등번호 OCR
- [ ] EasyOCR/PaddleOCR 통합
- [ ] 등번호 영역 검출 (YOLO 또는 별도 모델)
- [ ] OCR 결과 필터링 (숫자만, 1-99)
- [ ] 신뢰도 임계값 설정
- [ ] 성능 측정: 정확도 vs 속도

#### 실험 B: 추적 기반 (DeepSORT/ByteTrack)
- [ ] DeepSORT/ByteTrack 라이브러리 통합
- [ ] ReID 특징 추출 (외형 기반)
- [ ] 프레임 간 ID 일관성 유지
- [ ] 카메라 전환 감지 및 재초기화
- [ ] 성능 측정: ID 스와핑 빈도

#### 실험 C: 공간 정보 활용
- [ ] 필드 호모그래피 변환 구현
- [ ] 2D → 3D 좌표 매핑
- [ ] 포지션 기반 선수 매칭
- [ ] 선수 명단 입력 UI (팝업)
- [ ] 포지션 템플릿 (4-4-2, 4-3-3 등)

#### 하이브리드 통합
- [ ] 멀티모달 점수 시스템 구현
- [ ] 신뢰도 기반 표시 전략
  - 90%+: "손흥민 #7"
  - 70-90%: "손흥민 #7 (추정)"
  - 50-70%: "대한민국 공격수"
  - <50%: "대한민국 선수"
- [ ] Lazy Tracking 구현
  - [ ] Optical Flow 통합 (OpenCV)
  - [ ] 프레임 스킵 전략 (YOLO 1 : Flow 4)
  - [ ] 카메라 전환 자동 감지

#### 사용자 입력 시스템
- [ ] 경기 시작 시 팝업 UI
  - [ ] 양팀 선수 명단 입력
  - [ ] 포메이션 선택
  - [ ] 자동 불러오기 (API 연동, 선택적)
- [ ] 선수 교체 알림 및 수동 업데이트

### 예상 완료일
D+33 (Week 5 완료)

---

## Phase 4: Electron 패키징 (1주)

### 목표
Python 서버를 Electron 앱에 번들링하여 사용자 친화적 배포

### 작업 목록
- [ ] Electron 프로젝트 초기화
  - [ ] `electron-builder` 설정
  - [ ] 메인 프로세스/렌더러 프로세스 구조
- [ ] Python 서버 번들링
  - [ ] PyInstaller로 실행파일 변환
  - [ ] Electron 앱에 포함 (resources 폴더)
  - [ ] 자동 시작/종료 로직
- [ ] 시스템 트레이 통합
  - [ ] 트레이 아이콘 생성
  - [ ] 상태 표시 (실행 중/중지)
  - [ ] 우클릭 메뉴 (시작/중지/설정/종료)
- [ ] 자동 업데이트
  - [ ] `electron-updater` 통합
  - [ ] GitHub Releases 연동
- [ ] 설정 UI (선택적)
  - [ ] 포트 설정
  - [ ] 모델 선택 (nano/small/medium)
  - [ ] 프레임 레이트 조절
- [ ] 인스톨러 생성
  - [ ] Mac: .dmg
  - [ ] Windows: .exe (NSIS)

### 예상 완료일
D+40 (Week 6 완료)

---

## Phase 5: 파인튜닝 (병렬 진행, 2주)

### 목표
축구 특화 데이터셋으로 YOLO 모델 파인튜닝하여 정확도 향상

### 작업 목록
- [ ] 데이터셋 수집
  - [ ] Roboflow "Football Players Detection" 다운로드
  - [ ] SoccerNet 데이터셋 탐색
  - [ ] Kaggle 축구 데이터셋 병합
  - [ ] 목표: 3000+ 이미지
- [ ] 데이터 전처리
  - [ ] YOLO 포맷 변환 (annotations)
  - [ ] 클래스 매핑 (ball, player, referee)
  - [ ] Train/Val/Test 분할 (70/20/10)
- [ ] 학습 환경 구축
  - [ ] Google Colab or AWS SageMaker (GPU)
  - [ ] 학습 스크립트 작성
  - [ ] 하이퍼파라미터 설정
- [ ] 파인튜닝 실행
  - [ ] YOLOv8s 사전학습 모델 로드
  - [ ] 50-100 epochs 학습
  - [ ] Validation loss 모니터링
  - [ ] 최적 체크포인트 선택
- [ ] 평가 및 비교
  - [ ] 테스트 셋에서 mAP 측정
  - [ ] 기존 모델 vs 파인튜닝 모델 비교
  - [ ] 실제 영상에서 정성적 평가
- [ ] 모델 배포
  - [ ] CoreML 변환
  - [ ] Electron 앱에 통합
  - [ ] 버전 관리 (v1, v2...)

### 예상 완료일
D+40 (Week 6 완료, Phase 4와 병렬)

---

## Phase 6: 쿠팡플레이 지원 (1주)

### 목표
DRM이 있는 쿠팡플레이에서도 작동하도록 Screen Capture API 통합

### 작업 목록
- [ ] 권한 추가
  - [ ] `desktopCapture`, `tabCapture` manifest에 추가
- [ ] Screen Capture 로직
  - [ ] 사용자 권한 요청 플로우
  - [ ] 탭 화면 스트림 획득
  - [ ] Canvas 캡처 대체
- [ ] 플랫폼 자동 감지
  - [ ] URL 기반 플랫폼 구분
  - [ ] YouTube: Canvas 캡처 (빠름)
  - [ ] 쿠팡플레이: Screen Capture (느림)
- [ ] UX 개선
  - [ ] 권한 요청 안내 메시지
  - [ ] FAQ 추가 (왜 화면 공유가 필요한가?)

### 예상 완료일
D+47 (Week 7 완료)

---

## Phase 7: 배포 및 마케팅 (1주)

### 목표
Chrome Web Store 배포 및 초기 사용자 확보

### 작업 목록
- [ ] 스토어 제출 준비
  - [ ] 아이콘 디자인 (16x16, 48x48, 128x128)
  - [ ] 스크린샷 (5개, 1280x800)
  - [ ] 프로모션 비디오 (YouTube)
  - [ ] 상세 설명 작성 (한국어/영어)
  - [ ] 개인정보 처리방침 작성
- [ ] Chrome Web Store 제출
  - [ ] 개발자 계정 등록 ($5)
  - [ ] 익스텐션 업로드
  - [ ] 리뷰 대기 (1-3일)
- [ ] Companion 앱 배포
  - [ ] GitHub Releases 페이지 생성
  - [ ] .dmg/.exe 업로드
  - [ ] 설치 가이드 작성
- [ ] 웹사이트/랜딩 페이지
  - [ ] 간단한 소개 페이지
  - [ ] 데모 영상 임베드
  - [ ] 다운로드 링크
  - [ ] FAQ
- [ ] 문서화
  - [ ] 사용자 가이드 (README.md)
  - [ ] 개발자 문서 (기여 방법)
  - [ ] 트러블슈팅 가이드
- [ ] 커뮤니티 홍보
  - [ ] Reddit (r/soccer, r/chrome)
  - [ ] 클리앙, 루리웹 등 국내 커뮤니티
  - [ ] Product Hunt 등록
  - [ ] YouTube 리뷰어 컨택

### 예상 완료일
D+54 (Week 8 완료)

---

## 📊 마일스톤 요약

| 주차 | 마일스톤 | 완료 기준 |
|------|---------|----------|
| Week 1 | Phase 0 완료 | FPS 20+ 달성 |
| Week 2 | Phase 1 완료 | 로컬 비디오로 공 소유 판단 성공 |
| Week 3 | Phase 2 완료 | YouTube에서 실시간 오버레이 표시 |
| Week 4-5 | Phase 3 완료 | 선수 이름 70%+ 정확도 |
| Week 6 | Phase 4/5 완료 | Electron 앱 출시 + 파인튜닝 완료 |
| Week 7 | Phase 6 완료 | 쿠팡플레이 지원 |
| Week 8 | Phase 7 완료 | Chrome 스토어 배포 |

---

## 🚨 리스크 및 대응

### 리스크 1: 실시간 성능 부족
- **확률**: 중간
- **영향**: 높음
- **대응**:
  - 프레임 스킵 (10 FPS로 타협)
  - 모델 경량화 (yolov8-nano)
  - Optical Flow 적극 활용

### 리스크 2: 선수 식별 정확도 낮음
- **확률**: 높음
- **영향**: 중간
- **대응**:
  - 신뢰도 기반 표시 (불확실하면 팀만)
  - 사용자 수동 보정 기능 추가
  - "베타" 라벨 명시

### 리스크 3: DRM 플랫폼 미지원
- **확률**: 중간
- **영향**: 중간
- **대응**:
  - YouTube만으로 먼저 출시
  - Screen Capture API 실험
  - 지원 플랫폼 명시

### 리스크 4: Chrome 스토어 리젝
- **확률**: 낮음
- **영향**: 높음
- **대응**:
  - 정책 철저히 준수
  - 개인정보 수집 최소화
  - Companion 앱 필요성 명확히 설명

---

## 📌 다음 액션 (Phase 0 시작)

1. Python 가상환경 생성
2. YOLOv8 설치 및 샘플 테스트
3. YouTube에서 축구 영상 다운로드
4. FPS 벤치마크 실행

**시작 준비 완료!**
