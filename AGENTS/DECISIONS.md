# 주요 의사결정 기록

이 문서는 프로젝트 진행 중 내린 중요한 기술적/전략적 결정들을 기록합니다.

---

## 🎯 프로젝트 방향성

### 결정: 로컬 우선, 클라우드 제외
**날짜**: 2025-10-16

**배경**:
- 초기에는 저사양 PC 사용자를 위해 클라우드 API 옵션 고려
- 하지만 비용, 레이턴시, 프라이버시 이슈 존재

**결정**:
- **로컬 처리만** 지원
- 사용자 PC에 GPU가 없으면 사용 불가
- 최소 사양을 명시하고 안내

**이유**:
1. **비용 부담**: GPU 인스턴스 운영 비용 감당 어려움
2. **프라이버시**: 비디오 프레임을 외부로 전송하지 않음
3. **레이턴시**: 로컬 처리가 훨씬 빠름 (<5ms vs 200-500ms)
4. **복잡도**: 하이브리드 아키텍처는 개발/유지보수 부담

**트레이드오프**:
- ✅ 장점: 빠르고 안전하며 무료
- ❌ 단점: 저사양 PC 사용자 제외
- ⚖️ 판단: 타겟 사용자(축구 팬)는 대부분 최신 PC/Mac 보유 가능성 높음

---

## 🧠 선수 식별 전략

### 결정: 멀티모달 하이브리드 접근
**날짜**: 2025-10-16

**고려한 옵션**:
- **A. 추적 기반**: 등번호 OCR → DeepSORT 추적
- **B. 공간 기반**: 유니폼 색상 + 필드 위치 매칭
- **C. OCR만**: 매 프레임 등번호 읽기

**결정**:
- **A + B 하이브리드** (C는 너무 부정확하고 느림)
- 멀티모달 점수: 색상(40%) + OCR(30%) + 위치(20%) + 추적(10%)
- 신뢰도 기반 표시 (불확실하면 팀만 표시)

**이유**:
1. **등번호가 항상 보이지 않음**: 후면 샷 위주
2. **추적만으로는 부족**: 카메라 전환 시 놓침
3. **공간 정보만으로는 부정확**: 선수 교체, 포지션 변경
4. **조합이 가장 현실적**: 각 방법의 강점 활용

**예상 정확도**:
- 팀 구분: 95%+ (충분히 가능)
- 선수 이름: 70%+ (합리적 목표)
- 완벽한 식별은 불가능, 사용자 기대치 조정 필요

---

## ⚡ 성능 최적화

### 결정: Lazy Tracking 전략
**날짜**: 2025-10-16

**문제**:
- YOLO를 30 FPS로 실행하면 GPU 부하 과다
- 특히 추적 알고리즘까지 추가하면 더 무거움

**결정**:
- **5 프레임마다 YOLO 실행** (6 FPS)
- 나머지 4 프레임은 **Optical Flow**로 추적 (매우 가벼움)
- 카메라 전환 감지 시 즉시 YOLO 재실행

**이유**:
1. **Optical Flow는 10배 빠름**: OpenCV 기본 기능
2. **카메라가 고정되어 있을 때**: 선수 움직임은 예측 가능
3. **실시간 성능 확보**: 20-30 FPS 달성 가능

**구현**:
```python
if frame_count % 5 == 0 or detect_scene_change():
    detections = YOLO(frame)  # 무거움
else:
    detections = optical_flow_track(frame)  # 가벼움
```

---

## 🏗️ 아키텍처

### 결정: Electron + 크롬 익스텐션
**날짜**: 2025-10-16

**고려한 옵션**:
1. **순수 익스텐션 (ONNX Runtime Web)**: GPU 활용 제한적
2. **로컬 Python 서버 + 익스텐션**: 사용자가 수동 실행 필요
3. **Electron 앱 + 익스텐션**: 자동 실행, 사용자 친화적

**결정**:
- **Electron 앱으로 Python 서버 패키징**
- 크롬 익스텐션은 Companion App 필요 안내

**이유**:
1. **Metal/CUDA GPU 제대로 활용**: 브라우저 내 추론은 느림
2. **사용자 경험**: 수동 서버 실행은 진입장벽 높음
3. **배포 용이**: .dmg/.exe로 간단 설치
4. **선례 많음**: Grammarly, Loom 등 유사 구조

**트레이드오프**:
- ❌ 단점: 익스텐션만 설치로 끝나지 않음
- ✅ 장점: 실시간 성능 보장, 비용 없음

---

## 🎮 플랫폼 지원

### 결정: YouTube 우선, 쿠팡플레이는 Phase 2
**날짜**: 2025-10-16

**배경**:
- 쿠팡플레이는 DRM 가능성 높음
- Canvas 캡처 막힐 수 있음

**결정**:
- **Phase 1**: YouTube만 지원 (DRM 없음)
- **Phase 2**: 쿠팡플레이 Screen Capture API로 대응

**이유**:
1. **검증 우선**: YouTube로 프로토타입 빠르게 검증
2. **DRM 불확실성**: 쿠팡플레이 기술 스택 미확인
3. **점진적 확장**: 하나씩 해결하는 게 안전

**쿠팡플레이 대응책**:
- `desktopCapture` API 사용
- 사용자 화면 공유 권한 필요 (1회)
- Chrome 스토어 설명에 명시

---

## 🤖 YOLO 모델

### 결정: YOLOv8-small로 시작, 필요시 파인튜닝
**날짜**: 2025-10-16

**고려한 옵션**:
- YOLOv8-nano: 가장 빠름, 정확도 낮음
- YOLOv8-small: 균형
- YOLOv8-medium: 정확, 느림

**결정**:
- **Phase 0**: 사전학습 YOLOv8-small 테스트
- **정확도 부족 시**: 축구 데이터셋 파인튜닝
- **성능 부족 시**: YOLOv8-nano로 다운그레이드

**벤치마크 목표 (M4 기준)**:
- YOLOv8-small: 25-35 FPS 예상
- Lazy Tracking 적용 시 실효 FPS 더 높아짐

**파인튜닝 계획**:
- Roboflow + SoccerNet 데이터셋
- 50-100 epochs
- 공 탐지 90%+, 선수 탐지 85%+ 목표

---

## 📊 UI/UX

### 결정: 신뢰도 기반 표시 전략
**날짜**: 2025-10-16

**문제**:
- 선수 식별이 항상 정확하지 않음
- 잘못된 이름 표시하면 사용자 혼란

**결정**:
```
90%+ 신뢰도 → "손흥민 #7"
70-90% → "손흥민 #7 (추정)"
50-70% → "대한민국 공격수"
<50% → "대한민국 선수"
```

**이유**:
1. **투명성**: 사용자가 정확도 수준 파악
2. **신뢰 구축**: 확실하지 않으면 솔직하게 표시
3. **유연성**: 부분적 정보라도 유용함

**오버레이 디자인**:
- 피파 게임 스타일 (간결)
- 팀 색상으로 박스 구분
- 이름/번호는 작은 라벨

---

## 🔐 보안 및 프라이버시

### 결정: 완전한 로컬 처리
**날짜**: 2025-10-16

**정책**:
- ✅ 비디오 프레임: 로컬에서만 처리
- ✅ 외부 네트워크 통신: 없음 (localhost만)
- ✅ 개인정보 수집: 없음
- ✅ 경기 정보: 브라우저 로컬 스토리지만

**Chrome 스토어 준수**:
- 권한 최소화 (activeTab, storage만)
- 개인정보 처리방침 명시 (수집 없음)
- 오픈소스 (GitHub 공개)

---

## 📦 배포 전략

### 결정: Chrome Web Store + GitHub Releases
**날짜**: 2025-10-16

**익스텐션**:
- Chrome Web Store에 배포
- 무료 제공
- 오픈소스 (MIT 라이선스)

**Companion 앱**:
- GitHub Releases에서 다운로드
- Mac: .dmg
- Windows: .exe (추후)
- 자동 업데이트 지원 (electron-updater)

**수익화**:
- 현재: 없음 (무료)
- 향후 옵션:
  - 기부 (Buy Me a Coffee)
  - 프리미엄 기능 (고급 통계)
  - 클라우드 옵션 (추후 재고려)

---

## 🧪 테스트 전략

### 결정: 실용적 테스트 우선
**날짜**: 2025-10-16

**우선순위**:
1. **통합 테스트**: E2E 플로우 (프레임 캡처 → 추론 → 렌더링)
2. **성능 테스트**: FPS, 메모리 사용량
3. **실제 영상 테스트**: 다양한 경기 영상
4. **단위 테스트**: 핵심 로직만 (거리 계산 등)

**이유**:
- 프로토타입 단계에서는 완벽한 테스트 커버리지보다 빠른 검증 중요
- 실제 영상에서의 정성적 평가가 더 의미 있음

**테스트 데이터**:
- 다양한 조명 (주간/야간)
- 다양한 각도 (측면/후면/원경)
- 다양한 팀 유니폼 색상

---

## 📝 문서화 전략

### 결정: AGENTS 디렉토리에 프로젝트 지식 집중
**날짜**: 2025-10-16

**구조**:
```
AGENTS/
├── OVERVIEW.md         # 프로젝트 개요
├── ARCHITECTURE.md     # 기술 아키텍처
├── DEVELOPMENT_PLAN.md # 개발 플랜
├── TODO.md             # 작업 목록
├── DECISIONS.md        # 이 파일
└── EXPERIMENTS.md      # 실험 결과 (추후)
```

**이유**:
- 세션 컨텍스트 끊겨도 프로젝트 재개 가능
- 팀원 합류 시 빠른 온보딩
- 의사결정 히스토리 보존

---

## 🔄 업데이트 로그

| 날짜 | 결정 | 상태 |
|------|------|------|
| 2025-10-16 | 로컬 우선 전략 | ✅ 확정 |
| 2025-10-16 | 멀티모달 선수 식별 | ✅ 확정 |
| 2025-10-16 | Lazy Tracking | ✅ 확정 |
| 2025-10-16 | Electron 패키징 | ✅ 확정 |
| 2025-10-16 | YouTube 우선 지원 | ✅ 확정 |

---

## 📌 미결정 사항 (나중에 결정)

### 1. Windows 지원 여부
- **현재**: Mac 우선 개발 (M4 환경)
- **결정 시점**: Phase 4 (Electron 패키징 시)
- **고려사항**: Windows에서 CUDA GPU 지원 필요

### 2. 등번호 OCR vs 얼굴 인식
- **현재**: 등번호 OCR 우선
- **결정 시점**: Phase 3 (선수 식별 실험 후)
- **고려사항**: 얼굴 인식 데이터셋 구축 부담

### 3. 실시간 통계 기능
- **현재**: 공 소유자 표시만
- **결정 시점**: V2.0 기획 시
- **아이디어**: 패스 성공률, 터치 수, 히트맵 등

### 4. 다른 스포츠 지원
- **현재**: 축구만
- **결정 시점**: V2.0 이후
- **가능성**: 농구, 야구 등
